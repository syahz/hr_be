// ge/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}


model SuratPerintahPembayaran {
  id                              String   @id @default(uuid())
  upah                            Float
  bantuanDana                     Float // Melahirkan, kematian, dsb
  lembur                          Float
  tagihanKJPRI                    Float
  pphDuaSatuPekerja               Float
  pphDuaSatuPerusahaan            Float
  // BPJS Kesehatan
  premiBpjsKesehatan              Float
  bpjsKesehatanPerusahaan         Float // Premi x 80%
  bpjsKesehatanPekerja            Float // Premi x 20%
  bpjsKesehatanFamily             Float
  // BPJS Ketenagakerjaan
  iuranJkk                        Float // 0.24%
  iuranJkm                        Float // 0.30%
  iuranJhtTenagaKerja             Float // 2% dari upah
  iuranJpTenagaKerja              Float // 3% dari upah
  totalTagihanTenagaKerja         Float
  iuranJhtPerusahaan              Float // 3.7% dari upah
  iuranJpPerusahaan               Float // 2% dari upah
  totalTagihanPerusahaan          Float
  totalTagihanBpjsKetenagakerjaan Float
  piutang                         Float
  hutang                          Float
  unitId                          String
  unit                            Unit     @relation(fields: [unitId], references: [id])
  month                           Int
  year                            Int
  createdAt                       DateTime @default(now())
  updatedAt                       DateTime @updatedAt


  @@map("surat_perintah_pembayarans")
}

model User {
  id                String      @id @default(uuid())
  name              String
  email             String      @unique
  roleId            String
  unitId            String
  divisionId        String?
  role              Role        @relation(fields: [roleId], references: [id])
  unit              Unit        @relation(fields: [unitId], references: [id])
  division          Division?   @relation(fields: [divisionId], references: [id])
  refreshTokens     RefreshToken[]

  @@map("users")
}

model UnitVirtualAccount {
  id         String   @id @default(uuid())
  unitId     String
  unit       Unit     @relation(fields: [unitId], references: [id])
  vaNumber   String   @unique // Bisa Nomor VA atau bisa Keterangan (untuk Hutang)
  vaBank     String
  vaName     String // BPJS Kesehatan / BPJS Ketenagakerjaan

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("unit_virtual_accounts")
}

model Role {
  id         String @id @default(uuid())
  name       String @unique
  users      User[]

  @@map("roles")
}

model Division {
  id         String   @id @default(uuid())
  name       String   @unique
  users      User[]

  @@map("divisions")
}

model Unit {
  id                         String   @id @default(uuid())
  code                       String   @unique
  name                       String   @unique
  users                      User[]
  suratPerintahPembayarans   SuratPerintahPembayaran[]
  unitVirtualAccounts        UnitVirtualAccount[]
  @@map("units")
}

// For Auth
model RefreshToken {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  tokenHash  String   @unique
  revoked    Boolean  @default(false)
  replacedBy String?
  createdAt  DateTime @default(now())
  expiresAt  DateTime

  @@map("refresh_tokens")
}